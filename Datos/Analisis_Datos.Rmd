---
title: "Analisis De Datos"
author: "Alejandro Gil Villar"
date: "2023-10-06"
output:
  pdf_document: default
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r,fig.width=6, fig.height=3, message=FALSE,warning=FALSE,echo=FALSE}
library(readxl)
library(tidyr)
library(dplyr)
library(xlsx)
library(openxlsx)
library(ggplot2)
library(scales)
library(knitr)
library(officer)
library(flextable)
library(cartography)
library(mapSpain)
library(tidyverse)
library(sf)
```

```{r}
# Generar la paleta de colores
colores_verdes <- hcl.colors(100, "Greens")

# Color más claro
verde_claro <- colores_verdes[1]

# Color del medio
verde_medio <- colores_verdes[50]

# Color más oscuro
verde_oscuro <- colores_verdes[100]

# Mostrar los colores
print(paste("Verde más claro:", verde_claro))
print(paste("Verde del medio:", verde_medio))
print(paste("Verde más oscuro:", verde_oscuro))

```


```{r,fig.width=6, fig.height=3, echo = FALSE}
Poblacion_Provincias <- read_excel("Poblacion_Provincias.xlsx")

Agua_España <- read_excel("Agua_España.xlsx")

Poblacion_Comunidades <- read_excel("Poblacion_Comunidades.xlsx")
```



```{r,fig.width=6, fig.height=3, echo = FALSE , message=FALSE,warning=FALSE}
provincias <- esp_get_prov() %>% select(prov.shortname.es, geometry)

provincias$prov.shortname.es[provincias$prov.shortname.es == "La Coruña"] = "A Coruña"
provincias$prov.shortname.es[provincias$prov.shortname.es == "Gerona"] = "Girona"
provincias$prov.shortname.es[provincias$prov.shortname.es == "Lérida"] = "Lleida"
provincias$prov.shortname.es[provincias$prov.shortname.es == "Orense"] = "Ourense"

Poblacion_Provincias_Mapas = Poblacion_Provincias %>% filter(Provincia != "Total Nacional")

provincias = provincias %>% 
  left_join(Poblacion_Provincias_Mapas, by = c("prov.shortname.es" = "Provincia"))


```

```{r,fig.width=6, fig.height=3, echo = FALSE , message=FALSE,warning=FALSE}
ccaa <- esp_get_ccaa() %>% select(nuts2.name, geometry)

ccaa$nuts2.name[ccaa$nuts2.name == "Ciudad Autónoma de Ceuta"] = "Ceuta y Melilla"
ccaa$nuts2.name[ccaa$nuts2.name == "Ciudad Autónoma de Melilla"] = "Ceuta y Melilla"
ccaa$nuts2.name[ccaa$nuts2.name == "Illes Balears"] = "Islas Baleares"

Poblacion_Comunidades_Mapas = Poblacion_Comunidades %>% filter(Comunidad != "Total Nacional")

ccaa = ccaa %>% 
  left_join(Poblacion_Comunidades_Mapas, by = c("nuts2.name" = "Comunidad"))

```

```{r,fig.width=6, fig.height=3, echo = FALSE , message=FALSE,warning=FALSE}
ccaa_agua <- esp_get_ccaa() %>% select(nuts2.name, geometry)

ccaa_agua$nuts2.name[ccaa_agua$nuts2.name == "Ciudad Autónoma de Ceuta"] = "Ceuta y Melilla"
ccaa_agua$nuts2.name[ccaa_agua$nuts2.name == "Ciudad Autónoma de Melilla"] = "Ceuta y Melilla"
ccaa_agua$nuts2.name[ccaa_agua$nuts2.name == "Illes Balears"] = "Islas Baleares"


Agua_España_Mapas = Agua_España %>% filter(Comunidad != "Total Nacional")

ccaa_agua = ccaa_agua %>% 
  left_join(Agua_España_Mapas, by = c("nuts2.name" = "Comunidad"))

```

# Analisis Descriptivo de la Poblacion

```{r}
# Color Titulos
color_titulo = "#387C42" #Negrita
color_ejes = "#004616"
verde_claro = "#559757"
verde_oscuro = "#004616"
```


## Resumen de las variables

```{r,fig.width=6, fig.height=3, echo = FALSE}
Poblacion_Provincias_España = Poblacion_Provincias %>% 
  filter(Provincia == "Total Nacional") %>% 
  select(-Migracion_interna_entrada,-Migracion_interna_salida,-Variacion,-Comunidad,-Provincia)

Poblacion_Provincias_España = Poblacion_Provincias_España %>% 
  arrange(Año) %>% 
  group_by(Año) %>% 
  mutate(Migracion = round(Migracion_externa_entrada - Migracion_externa_salida))

Poblacion_Provincias_España$Año <- as.numeric(Poblacion_Provincias_España$Año)

#summary(Poblacion_Provincias_España)
```

\newpage

## Grafico de la Poblacion Anual de España

```{r,fig.width=7, fig.height=4, echo = FALSE}
ggplot(Poblacion_Provincias_España, aes(x=Año, y=Total, group = 1)) +
  geom_line(color=verde_claro, size = 1) + # Utilizando el color verde claro para la línea
  scale_y_continuous(labels = comma_format(scale = 1e-6, suffix = " M")) +
  scale_x_continuous(breaks = seq(1975, 2020, by = 5)) +
  labs(x="Año",
       y="Población",
       title = "Evolución de la población de España entre los años 1975 y 2021") +
  theme_minimal() +
  theme(legend.position = "top",
        #plot.title = element_text(color = color_titulo, face="bold"),
        #axis.title.x = element_text(color = color_ejes),
        #axis.title.y = element_text(color = color_ejes),
        #panel.grid.major = element_blank(),
        #panel.grid.minor = element_blank()
        ) # Color del texto de los ejes
```



## Grafico de la Natalidad vs Mortalidad en España

```{r,fig.width=8, fig.height=4, echo = FALSE}
ggplot(Poblacion_Provincias_España, aes(x = Año)) +
  geom_area(aes(y = Natalidad, group = 1, fill = "Natalidad"), alpha=0.5) +
  geom_line(aes(y = Natalidad, group = 1, color = "Natalidad"), size=0.7) + # Borde más grueso para Natalidad
  geom_area(aes(y = Mortalidad, group = 1, fill = "Mortalidad"), alpha=0.5) +
  geom_line(aes(y = Mortalidad, group = 1, color = "Mortalidad"), size=0.7) + # Borde más grueso para Mortalidad
  scale_x_continuous(breaks = seq(1975, 2020, by = 5)) +
  labs(x = "Año", y = "Población", title = "Natalidad vs Mortalidad en España") +
  scale_fill_manual(values = c("Natalidad" = verde_claro, "Mortalidad" = verde_oscuro), name = "Leyenda") +
  scale_color_manual(values = c("Natalidad" = verde_claro, "Mortalidad" = verde_oscuro)) +
  guides(color = FALSE) + # Ocultar la leyenda de color
  scale_y_continuous(labels = function(x) gsub(",000", " mil", comma(x))) +
  theme_minimal() +
  theme(legend.position = "top",
        #plot.title = element_text(color = color_titulo, face="bold"),
        #axis.title.x = element_text(color = color_ejes),
        #axis.title.y = element_text(color = color_ejes),
        #panel.grid.major = element_blank(),
        #panel.grid.minor = element_blank()
        )
```

\newpage

## Grafico de la Migracion Anual en España

```{r,fig.width=8, fig.height=4, echo = FALSE}
ggplot(filter(Poblacion_Provincias_España, Año >= 2008), aes(x = Año)) +
  geom_area(aes(y = Migracion_externa_entrada, group = 1, fill = "Migración Entrada"), alpha=0.5) +
  geom_line(aes(y = Migracion_externa_entrada, group = 1, color = "Migración Entrada"), size=0.7) + # Borde más grueso para Migracion_entrada
  geom_area(aes(y = Migracion_externa_salida, group = 1, fill = "Migración Salida"), alpha=0.5) +
  geom_line(aes(y = Migracion_externa_salida, group = 1, color = "Migración Salida"), size=0.7) + # Borde más grueso para Migracion_salida
  labs(x = "Año", y = "Población", title = "Migración Anual en España") +
  scale_fill_manual(values = c("Migración Entrada" = verde_claro, "Migración Salida" = verde_oscuro), name = "Leyenda") +
  scale_color_manual(values = c("Migración Entrada" = verde_claro, "Migración Salida" = verde_oscuro)) +
  scale_y_continuous(labels = function(x) gsub(",000", " mil", comma(x))) +
  guides(color = FALSE) + # Ocultar la leyenda de color
  theme_minimal() +
  theme(legend.position = "top",
        #plot.title = element_text(color = color_titulo, face="bold"),
        #axis.title.x = element_text(color = color_ejes),
        #axis.title.y = element_text(color = color_ejes),
        #panel.grid.major = element_blank(),
        #panel.grid.minor = element_blank()
        )
```

\newpage

## Grafico del Aumento y disminucion de la Poblacion en España

```{r,fig.width=8, fig.height=4, echo = FALSE,warning=FALSE,message=FALSE}
ggplot(Poblacion_Provincias_España, aes(x = Año)) +
  geom_area(aes(y = Natalidad + Migracion_externa_entrada, fill = "Natalidad + Migración Entrante", group=1), alpha=0.5) +
  geom_line(aes(y = Natalidad + Migracion_externa_entrada, color = "Natalidad + Migración Entrante", group=1), size=0.7) +
  geom_area(aes(y = Mortalidad + Migracion_externa_salida, fill = "Mortalidad + Migración Saliente", group=1), alpha=0.5) +
  geom_line(aes(y = Mortalidad + Migracion_externa_salida, color = "Mortalidad + Migración Saliente", group=1), size=0.7) +
  scale_color_manual(values = c("Natalidad + Migración Entrante" = verde_claro, "Mortalidad + Migración Saliente" = verde_oscuro)) + 
  scale_fill_manual(values = c("Natalidad + Migración Entrante" = verde_claro, "Mortalidad + Migración Saliente" = verde_oscuro),
                    name = "Categoría",
                    labels = c("Natalidad + Migración Entrante", "Mortalidad + Migración Saliente")) +
  scale_x_continuous(breaks = seq(1975, 2020, by = 5)) +
  labs(x = "Año", y = "Valores", title = "Aumento y Disminución de la Población") +
  guides(color = FALSE) + # Ocultar la leyenda de color
  theme_minimal() +
  theme(legend.position = "top",
        #plot.title = element_text(color = color_titulo, face="bold"),
        #axis.title.x = element_text(color = color_ejes),
        #axis.title.y = element_text(color = color_ejes),
        #panel.grid.major = element_blank(),
        #panel.grid.minor = element_blank()
        ) +
  scale_y_continuous(labels = function(x) gsub(",000", " mil", comma(x)))

```



# Analisis poblacion para las Comunidades

## Mapa de Calor sobre la Poblacion de las Comunidades Autónomas.

```{r,fig.width=7, fig.height=4, echo = FALSE}
# Calcula los valores máximos y mínimos para definir los límites de la paleta
max_valor <- max(filter(ccaa, Año == 2021)$Poblacion_Comunidad)
min_valor <- min(filter(ccaa, Año == 1975)$Poblacion_Comunidad)

# Define una paleta de colores basada en los valores de Total para 2021
paleta_colores <- scale_fill_gradientn(
  colors = rev(hcl.colors(100, "Greens")),
  limits = c(min_valor, max_valor),# Elige la paleta de colores
  n.breaks = 8,  # O el número deseado de intervalos
  labels = scales::label_comma(),
  guide = guide_legend()
)

ggplot(filter(Poblacion_Comunidades, Comunidad != "Total Nacional" & Comunidad != "Ceuta y Melilla"), 
       aes(reorder(Siglas_Comunidad, Poblacion_Comunidad,decreasing=TRUE), Año, fill = Poblacion_Comunidad)) +
  geom_tile() +
  paleta_colores +
  labs(fill = "Habitantes",
       title = "Población para cada Comunidad Autónoma",
       x="Siglas Comunidad") +
  theme_minimal()
```

  
\newpage

## Mapa de Calor sobre la Natalidad para cada Comunidad Autónoma


```{r,fig.width=7, fig.height=4, echo = FALSE}
# Calcula los valores máximos y mínimos para definir los límites de la paleta
max_valor <- max(ccaa$Natalidad_Comunidad)
min_valor <- min(ccaa$Natalidad_Comunidad)

# Define una paleta de colores basada en los valores de Total para 2021
paleta_colores <- scale_fill_gradientn(
  colors = rev(hcl.colors(100, "Greens")),
  limits = c(min_valor, max_valor),# Elige la paleta de colores
  n.breaks = 8,  # O el número deseado de intervalos
  labels = scales::label_comma(),
  guide = guide_legend()
)

# Crea el mapa de calor
ggplot(filter(Poblacion_Comunidades, Comunidad != "Total Nacional" & Comunidad != "Ceuta y Melilla"),
       aes(reorder(Siglas_Comunidad, Poblacion_Comunidad,decreasing=TRUE), Año, fill = Natalidad_Comunidad)) +
  geom_tile() +
  paleta_colores +
  labs(fill = "Recien Nacidos",
       title = "Natalidad para cada Comunidad Autónoma",
       x="Siglas Comunidad") +
  theme_minimal()
```

## Mapa de Calor sobre la Mortalidad para cada Comunidad Autónoma


```{r,fig.width=7, fig.height=4, echo = FALSE}
# Calcula los valores máximos y mínimos para definir los límites de la paleta
max_valor <- max(ccaa$Mortalidad_Comunidad)
min_valor <- min(ccaa$Mortalidad_Comunidad)

# Define una paleta de colores basada en los valores de Total para 2021
paleta_colores <- scale_fill_gradientn(
  colors = rev(hcl.colors(100, "Greens")),
  limits = c(min_valor, max_valor),# Elige la paleta de colores
  n.breaks = 8,  # O el número deseado de intervalos
  labels = scales::label_comma(),
  guide = guide_legend()
)

# Crea el mapa de calor
ggplot(filter(Poblacion_Comunidades, Comunidad != "Total Nacional" & Comunidad != "Ceuta y Melilla"),
       aes(reorder(Siglas_Comunidad, Poblacion_Comunidad,decreasing=TRUE), Año, fill = Mortalidad_Comunidad)) +
  geom_tile() +
  paleta_colores +
  labs(fill = "Fallecidos",
       title = "Mortalidad para cada Comunidad Autónoma",
       x="Siglas Comunidad") +
  theme_minimal()
```




## Mapa de Calor sobre la Migracion interior de entrada para cada Comunidad Autónoma


```{r,fig.width=7, fig.height=4, echo = FALSE}
# Calcula los valores máximos y mínimos para definir los límites de la paleta
max_valor <- max(ccaa$Mig_in_ent__Comunidad)
min_valor <- min(filter(ccaa,Año > 2007 & Año <2022)$Mig_in_ent__Comunidad)

# Define una paleta de colores basada en los valores de Total para 2021
paleta_colores <- scale_fill_gradientn(
  colors = rev(hcl.colors(100, "Greens")),
  limits = c(min_valor, max_valor),# Elige la paleta de colores
  n.breaks = 8,  # O el número deseado de intervalos
  labels = scales::label_comma(),
  guide = guide_legend()
)

# Crea el mapa de calor
ggplot(filter(Poblacion_Comunidades, Comunidad != "Total Nacional" & Comunidad != "Ceuta y Melilla" & Año > 2007),
       aes(reorder(Siglas_Comunidad, Poblacion_Comunidad,decreasing=TRUE), Año, fill = Mig_in_ent__Comunidad)) +
  geom_tile() +
  paleta_colores +
  labs(fill = "Migrantes",
       title = "Migración interior de entrada para cada Comunidad Autónoma",
       x="Siglas Comunidad") +
  theme_minimal()
```


## Mapa de Calor sobre la Migracion interior de salida para cada Comunidad`


```{r,fig.width=7, fig.height=4, echo = FALSE}
# Calcula los valores máximos y mínimos para definir los límites de la paleta
max_valor <- max(ccaa$Mig_in_sal_Comunidad)
min_valor <- min(filter(ccaa,Año > 2007 & Año <2022)$Mig_in_sal_Comunidad)

# Define una paleta de colores basada en los valores de Total para 2021
paleta_colores <- scale_fill_gradientn(
  colors = rev(hcl.colors(100, "Greens")),
  limits = c(min_valor, max_valor),# Elige la paleta de colores
  n.breaks = 8,  # O el número deseado de intervalos
  labels = scales::label_comma(),
  guide = guide_legend()
)
# Crea el mapa de calor
ggplot(filter(Poblacion_Comunidades, Comunidad != "Total Nacional" & Comunidad != "Ceuta y Melilla" & Año > 2007),
       aes(reorder(Siglas_Comunidad, Poblacion_Comunidad,decreasing=TRUE), Año, fill = Mig_in_sal_Comunidad)) +
  geom_tile() +
  paleta_colores +
  labs(fill = "Migrantes",
       title = "Migración interior de salida para cada Comunidad Autónoma",
       x="Siglas Comunidad") +
  theme_minimal()
```



## Mapa de Calor sobre la Migracion exterior de entrada para cada Comunidad Autónoma


```{r,fig.width=7, fig.height=4, echo = FALSE}
# Calcula los valores máximos y mínimos para definir los límites de la paleta
max_valor <- max(ccaa$Mig_ex_ent__Comunidad)
min_valor <- min(filter(ccaa,Año > 2007 & Año <2022)$Mig_ex_ent__Comunidad)

# Define una paleta de colores basada en los valores de Total para 2021
paleta_colores <- scale_fill_gradientn(
  colors = rev(hcl.colors(100, "Greens")),
  limits = c(min_valor, max_valor),# Elige la paleta de colores
  n.breaks = 12,  # O el número deseado de intervalos
  labels = scales::label_comma(),
  guide = guide_legend()
)
# Crea el mapa de calor
ggplot(filter(Poblacion_Comunidades, Comunidad != "Total Nacional" & Comunidad != "Ceuta y Melilla" & Año > 2007),
       aes(reorder(Siglas_Comunidad, Poblacion_Comunidad,decreasing=TRUE), Año, fill = Mig_ex_ent__Comunidad)) +
  geom_tile() +
  paleta_colores +
  labs(fill = "Migrantes",
       title = "Migración exterior de entrada para cada Comunidad Autónoma",
       x="Siglas Comunidad") +
  theme_minimal()
```




## Mapa de Calor sobre la Migracion exterior de salida para cada Comunidad


```{r,fig.width=7, fig.height=4, echo = FALSE}
# Calcula los valores máximos y mínimos para definir los límites de la paleta
max_valor <- max(ccaa$Mig_ex_sal_Comunidad)
min_valor <- min(filter(ccaa,Año > 2007 & Año <2022)$Mig_ex_sal_Comunidad)

# Define una paleta de colores basada en los valores de Total para 2021
paleta_colores <- scale_fill_gradientn(
  colors = rev(hcl.colors(100, "Greens")),
  limits = c(min_valor, max_valor),# Elige la paleta de colores
  n.breaks = 8,  # O el número deseado de intervalos
  labels = scales::label_comma(),
  guide = guide_legend()
)

# Crea el mapa de calor
ggplot(filter(Poblacion_Comunidades, Comunidad != "Total Nacional" & Comunidad != "Ceuta y Melilla" & Año > 2007), aes(reorder(Siglas_Comunidad, Poblacion_Comunidad,decreasing=TRUE), Año, fill = Mig_ex_sal_Comunidad)) +
  geom_tile() +
  paleta_colores +
  labs(fill = "Migrantes",
       title = "Migración exterior de salida para cada Comunidad Autónoma",
       x="Siglas Comunidad") +
  theme_minimal()
```




# Mapas sobre la Poblacion en las Provincias

## Mapa Poblacion para las Provincias de España

```{r,fig.width=7, fig.height=4, echo = FALSE}
# Calcula los valores máximos y mínimos para definir los límites de la paleta
max_valor <- max(filter(provincias, Año == 2021)$Total)
min_valor <- min(filter(provincias, Año == 2021)$Total)

# Define una paleta de colores basada en los valores de Total para 2021
paleta_colores <- scale_fill_gradientn(
  colors = rev(hcl.colors(100, "Greens")),
  limits = c(min_valor, max_valor),# Elige la paleta de colores
  n.breaks = 13,  # O el número deseado de intervalos
  labels = scales::label_comma(),
  guide = guide_legend()
)

# Mapa 2021
ggplot(filter(provincias,Año == 2021)) +
  geom_sf(aes(fill = Total), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Habitantes",
    title = "Población por Província",
    subtitle = "Datos 2021"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .5),
    plot.subtitle = element_text(hjust = .5))


# Mapa 2010
ggplot(filter(provincias,Año == 2010)) +
  geom_sf(aes(fill = Total), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Habitantes",
    title = "Población por Província",
    subtitle = "Datos 2010"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .5),
    plot.subtitle = element_text(hjust = .5))


# Mapa 2000
ggplot(filter(provincias,Año == 2000)) +
  geom_sf(aes(fill = Total), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Habitantes",
    title = "Población por Província",
    subtitle = "Datos 2000"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .5),
    plot.subtitle = element_text(hjust = .5))

```

## Mapa Densidad de Poblacion para las Provincias de España

```{r,fig.width=7, fig.height=4, echo = FALSE}
# Calcula los valores máximos y mínimos para definir los límites de la paleta
max_valor <- max(filter(provincias, Año == 2021 & Comunidad != "Ceuta y Melilla")$Poblacion_Km2)
min_valor <- min(filter(provincias, Año == 2021)$Poblacion_Km2)

# Define una paleta de colores basada en los valores de Total para 2021
paleta_colores <- scale_fill_gradientn(
  colors = rev(hcl.colors(100, "Greens")),
  limits = c(min_valor, max_valor),# Elige la paleta de coles
  n.breaks = 8,  # O el número deseado de intervalos
  labels = scales::label_comma(),
  guide = guide_legend()
)

# Mapa 2021
ggplot(filter(provincias,Año == 2021)) +
  geom_sf(aes(fill = Poblacion_Km2), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Habitantes por Km2",
    title = "Densidad de Población por Província",
    subtitle = "Datos 2021"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .5),
    plot.subtitle = element_text(hjust = .5))


# Mapa 2010
ggplot(filter(provincias,Año == 2010)) +
  geom_sf(aes(fill = Poblacion_Km2), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Habitantes por Km2",
    title = "Densidad de Población por Província",
    subtitle = "Datos 2010"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .5),
    plot.subtitle = element_text(hjust = .5))


# Mapa 2000
ggplot(filter(provincias,Año == 2000)) +
  geom_sf(aes(fill = Poblacion_Km2), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Habitantes por Km2",
    title = "Densidad de Población por Província",
    subtitle = "Datos 2000"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .5),
    plot.subtitle = element_text(hjust = .5))

```

\newpage

# Mapas sobre la Poblacion en las Comunidades

## Mapa Poblacion para las Comunidades de España

```{r,fig.width=7, fig.height=4, echo = FALSE}
# Calcula los valores máximos y mínimos para definir los límites de la paleta
max_valor <- max(filter(ccaa, Año == 2021)$Poblacion_Comunidad)
min_valor <- min(filter(ccaa, Año == 2021)$Poblacion_Comunidad)

# Define una paleta de colores basada en los valores de Total para 2021
paleta_colores <- scale_fill_gradientn(
  colors = rev(hcl.colors(100, "Greens")),
  limits = c(min_valor, max_valor),# Elige la paleta de colores
  n.breaks = 8,  # O el número deseado de intervalos
  labels = scales::label_comma(),
  guide = guide_legend()
)

# Mapa 2021
ggplot(filter(ccaa,Año == 2021)) +
  geom_sf(aes(fill = Poblacion_Comunidad), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Habitantes", 
    title = "Población por Comunidad Autónoma",
    subtitle = "Datos 2021"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .5),
    plot.subtitle = element_text(hjust = .5))


# Mapa 2010
ggplot(filter(ccaa,Año == 2010)) +
  geom_sf(aes(fill = Poblacion_Comunidad), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Habitantes",
    title = "Población por Comunidad Autónoma",
    subtitle = "Datos 2010"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .5),
    plot.subtitle = element_text(hjust = .5))


# Mapa 2000
ggplot(filter(ccaa,Año == 2000)) +
  geom_sf(aes(fill = Poblacion_Comunidad), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Habitantes",
    title = "Población por Comunidad Autónoma",
    subtitle = "Datos 2000"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .5),
    plot.subtitle = element_text(hjust = .5))

```


## Mapa Densidad de Poblacion para las Comunidades de España

```{r,fig.width=7, fig.height=4, echo = FALSE}
# Calcula los valores máximos y mínimos para definir los límites de la paleta
max_valor <- max(filter(ccaa, Año == 2021 & nuts2.name != "Ceuta y Melilla")$Densidad_Comunidad)
min_valor <- min(filter(ccaa, Año == 2000)$Densidad_Comunidad) - 1

intervalos <- seq(min_valor, max_valor, length.out = 21)

ccaa$intervalo <- cut(ccaa$Densidad_Comunidad, intervalos)

paleta_colores <- scale_fill_manual(values = rev(hcl.colors(8, "Greens")),
                                    name = "Densidad de Población")


ggplot(filter(ccaa,Año == 2021 & nuts2.name != "Ceuta y Melilla")) +
  geom_sf(aes(fill = intervalo), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Habitantes por Km2",
    title = "Densidad de Población por Comunidad Autónoma",
    subtitle = "Datos 2021"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .5),
    plot.subtitle = element_text(hjust = .5))

ggplot(filter(ccaa,Año == 2010 & nuts2.name != "Ceuta y Melilla")) +
  geom_sf(aes(fill = intervalo), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Habitantes por Km2",
    title = "Densidad de Población por Comunidad Autónoma",
    subtitle = "Datos 2010"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .5),
    plot.subtitle = element_text(hjust = .5))

ggplot(filter(ccaa,Año == 2000 & nuts2.name != "Ceuta y Melilla")) +
  geom_sf(aes(fill = intervalo), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Habitantes por Km2",
    title = "Densidad de Población por Comunidad Autónoma",
    subtitle = "Datos 2000"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .5),
    plot.subtitle = element_text(hjust = .5))


```

## Mapa Variacion de Poblacion para las Comunidades de España

```{r,fig.width=7, fig.height=4, echo = FALSE}
# Calcula los valores máximos y mínimos para definir los límites de la paleta
max_valor <- max(filter(ccaa, Año == 2020)$Variacion_Poblacion_10)
min_valor <- min(filter(ccaa, Año == 2020)$Variacion_Poblacion_10) - 1

# Define una paleta de colores basada en los valores de Total para 2021
paleta_colores <- scale_fill_gradientn(
  colors = hcl.colors(100, "RdBu"),
  limits = c(min_valor, max_valor),# Elige la paleta de colores
  n.breaks = 10,  # O el número deseado de intervalos
  labels = scales::label_comma(),
  guide = guide_legend()
)


ggplot(filter(ccaa,Año == 2020 & nuts2.name != "Ceuta y Melilla")) +
  geom_sf(aes(fill = Variacion_Poblacion_2), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Variación 2 años",
    title = "Variación de Población por Comunidad Autónoma",
    subtitle = "Variación ente 2020-2018"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .5),
    plot.subtitle = element_text(hjust = .5))


ggplot(filter(ccaa,Año == 2020 & nuts2.name != "Ceuta y Melilla")) +
  geom_sf(aes(fill = Variacion_Poblacion_4), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Variación 4  años",
    title = "Variación de Población por Comunidad Autónoma",
    subtitle = "Variación ente 2020-2016"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .5),
    plot.subtitle = element_text(hjust = .5))


ggplot(filter(ccaa,Año == 2020 & nuts2.name != "Ceuta y Melilla")) +
  geom_sf(aes(fill = Variacion_Poblacion_10), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Variación 10 años",
    title = "Variación de Población por Comunidad Autónoma",
    subtitle = "Variación ente 2020-2010"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .5),
    plot.subtitle = element_text(hjust = .5))


```


# Analisis Descriptivo de los Recursos Hidricos

```{r}
# Color Titulos
color_titulo_rh = "#118DFF" #Negrita
color_ejes = "#12239E"
azul_claro = "#118DFF"
azul_oscuro = "#12239E"
```

```{r,fig.width=6, fig.height=3, echo = FALSE}
Agua_Total_España = Agua_España %>% 
  filter(Comunidad == "Total Nacional") %>% 
  select(-Comunidad)

Agua_Total_España$Año <- as.numeric(Agua_Total_España$Año)
```

## Grafico del Suministro Anual de Agua en España

```{r,fig.width=8, fig.height=4, echo = FALSE}
ggplot(Agua_Total_España,aes(x=Año,y=`Volumen de agua suministrada`,group = 1)) +
  geom_line(color=azul_claro, size = 1) +
  scale_y_continuous(labels = comma_format(scale = 1e-6, suffix = " M")) + 
  labs(x="Año",
       y="Suministro de Agua (m3)",
       title = "Suministro Anual de Agua en España")+
  theme_minimal() +
  theme(legend.position = "top",
        #plot.title = element_text(color = color_titulo, face="bold"),
        #axis.title.x = element_text(color = color_ejes),
        #axis.title.y = element_text(color = color_ejes),
        #panel.grid.major = element_blank(),
        #panel.grid.minor = element_blank()
        )
```



## Grafico del Suministro Real de Agua en España

```{r,fig.width=8, fig.height=4, echo = FALSE}
ggplot(Agua_Total_España,aes(x=Año,y=`Volumen de agua registrada y distribuida`,group = 1)) +
  geom_line(color=azul_claro, size = 1) +
  scale_y_continuous(labels = comma_format(scale = 1e-6, suffix = " M")) + 
  labs(x="Año",
       y="Suministro de Agua (m3)",
       title = "Suministro Real de Agua en España")+
  theme_minimal() +
  theme(#plot.title = element_text(color = color_titulo_rh, face="bold"),
        #axis.title.x = element_text(color = color_ejes),
        #axis.title.y = element_text(color = color_ejes),
        #panel.grid.major = element_blank(), # Eliminando la cuadrícula principal
        #panel.grid.minor = element_blank() # Eliminando la cuadrícula secundaria
        )
```



## Grafico del Suministro Perdido de Agua en España

```{r,fig.width=8, fig.height=4, echo = FALSE}
ggplot(Agua_Total_España,aes(x=Año,y=`Volumen de agua no registrada`,group = 0.7)) +
  geom_line(color=azul_claro, size = 1) +
  scale_y_continuous(labels = comma_format(scale = 1e-6, suffix = " M")) + 
  labs(x="Año",
       y="Suministro de Agua (m3)",
       title = "Suministro Perdido de Agua en España")+
  theme_minimal() +
  theme(#plot.title = element_text(color = color_titulo_rh, face="bold"),
        #axis.title.x = element_text(color = color_ejes),
        #axis.title.y = element_text(color = color_ejes),
        #panel.grid.major = element_blank(), # Eliminando la cuadrícula principal
        #panel.grid.minor = element_blank() # Eliminando la cuadrícula secundaria
        )
```


## Grafico del Suministro de Agua por Grupo de Usuarios

```{r,fig.width=8, fig.height=4, echo = FALSE}
ggplot(Agua_Total_España,aes(x=Año,y=Hogares,group = 0.7)) +
  geom_line(color=azul_claro, size = 1) +
  scale_y_continuous(labels = comma_format(scale = 1e-6, suffix = " M")) + 
  labs(x="Año",
       y="Suministro de Agua (m3)",
       title = "Suministro de Agua en España para los Hogares")+
  theme_minimal() +
  theme(#plot.title = element_text(color = color_titulo_rh, face="bold"),
        #axis.title.x = element_text(color = color_ejes),
        #axis.title.y = element_text(color = color_ejes),
        #panel.grid.major = element_blank(), # Eliminando la cuadrícula principal
        #panel.grid.minor = element_blank() # Eliminando la cuadrícula secundaria
        )
```

```{r,fig.width=8, fig.height=4, echo = FALSE}
ggplot(Agua_Total_España, aes(x = Año)) +
  geom_line(aes(y = Hogares/`Volumen de agua registrada y distribuida` * 100, group = 1),color=azul_claro, size = 0.7) +
  labs(x = "Año", y = "Porcentaje %",title = "Porcentaje del Suministro de Agua en Hogares")+
  theme_minimal() +
  theme(#plot.title = element_text(color = color_titulo_rh, face="bold"),
        #axis.title.x = element_text(color = color_ejes),
        #axis.title.y = element_text(color = color_ejes),
        #panel.grid.major = element_blank(), # Eliminando la cuadrícula principal
        #panel.grid.minor = element_blank() # Eliminando la cuadrícula secundaria
        )
```

\newpage

```{r,fig.width=8, fig.height=4, echo = FALSE}
ggplot(Agua_Total_España,aes(x=Año,y=`Sectores económicos`,group = 0.7)) +
  geom_line(color=azul_claro, size = 1) +
  scale_y_continuous(labels = comma_format(scale = 1e-6, suffix = " M")) + 
  labs(x="Año",
       y="Suministro de Agua (m3)",
       title = "Suministro de Agua en España para los Sectores Económicos")+
  theme_minimal() +
  theme(#plot.title = element_text(color = color_titulo_rh, face="bold"),
        #axis.title.x = element_text(color = color_ejes),
        #axis.title.y = element_text(color = color_ejes),
        #panel.grid.major = element_blank(), # Eliminando la cuadrícula principal
        #panel.grid.minor = element_blank() # Eliminando la cuadrícula secundaria
        )
```

```{r,fig.width=8, fig.height=4, echo = FALSE}
ggplot(Agua_Total_España, aes(x = Año)) +
  geom_line(aes(y = `Sectores económicos`/`Volumen de agua registrada y distribuida`* 100, group = 1), color=azul_claro, size = 0.7) +
  labs(x = "Año", y = "Porcentaje %",title = "Porcentaje del Suministro de Agua en Sectores Económicos") +
  theme_minimal() +
  theme(#plot.title = element_text(color = color_titulo_rh, face="bold"),
        #axis.title.x = element_text(color = color_ejes),
        #axis.title.y = element_text(color = color_ejes),
        #panel.grid.major = element_blank(), # Eliminando la cuadrícula principal
        #panel.grid.minor = element_blank() # Eliminando la cuadrícula secundaria
        )
```



\newpage

```{r,fig.width=8, fig.height=4, echo = FALSE}
ggplot(Agua_Total_España,aes(x=Año,y=`Consumos municipales`,group = 0.7)) +
  geom_line(color=azul_claro, size = 1) +
  scale_y_continuous(labels = comma_format(scale = 1e-6, suffix = " M")) + 
  labs(x="Año",
       y="Suministro de Agua (m3)",
       title = "Suministro de Agua en España para los Consumos Municipales")+
  theme_minimal() +
  theme(#plot.title = element_text(color = color_titulo_rh, face="bold"),
        #axis.title.x = element_text(color = color_ejes),
        #axis.title.y = element_text(color = color_ejes),
        #panel.grid.major = element_blank(), # Eliminando la cuadrícula principal
        #panel.grid.minor = element_blank() # Eliminando la cuadrícula secundaria
        )
```


```{r,fig.width=8, fig.height=4, echo = FALSE}
ggplot(Agua_Total_España, aes(x = Año)) +
  geom_line(aes(y = `Consumos municipales`/`Volumen de agua registrada y distribuida`* 100, group = 1),color=azul_claro, size = 0.7) +
  labs(x = "Año", y = "Porcentaje %",title = "Porcentaje del Suministro de Agua en Consumos municipales") +
  theme_minimal() +
  theme(#plot.title = element_text(color = color_titulo_rh, face="bold"),
        #axis.title.x = element_text(color = color_ejes),
        #axis.title.y = element_text(color = color_ejes),
        #panel.grid.major = element_blank(), # Eliminando la cuadrícula principal
        #panel.grid.minor = element_blank() # Eliminando la cuadrícula secundaria
        )
```


## Grafico de las Disponibilidad de Agua potable en España

```{r,fig.width=8, fig.height=4, echo = FALSE}
ggplot(Agua_Total_España,aes(x=Año,y=Disponible_para_Potabilizacion,group = 1)) +
  geom_line(color=azul_claro, size = 0.7) +
  scale_y_continuous(labels = comma_format(scale = 1e-6, suffix = " M")) + 
  labs(x="Año",
       y="Suministro de Agua (m3)",
       title = "Agua Disponible Potable")+
  theme_minimal() +
  theme(#plot.title = element_text(color = color_titulo_rh, face="bold"),
        #axis.title.x = element_text(color = color_ejes),
        #axis.title.y = element_text(color = color_ejes),
        #panel.grid.major = element_blank(), # Eliminando la cuadrícula principal
        #panel.grid.minor = element_blank() # Eliminando la cuadrícula secundaria
        )
```


## Grafico de las Disponibilidad de Agua no Potable en España

```{r,fig.width=8, fig.height=4, echo = FALSE}
ggplot(Agua_Total_España,aes(x=Año,y=Disponible_no_Potabilizada,group = 1)) +
  geom_line(color=azul_claro, size = 0.7) +
  scale_y_continuous(labels = comma_format(scale = 1e-6, suffix = " M")) + 
  labs(x="Año",
       y="Suministro de Agua (m3)",
       title = "Agua Disponible No Potable")+
  theme_minimal() +
  theme(#plot.title = element_text(color = color_titulo_rh, face="bold"),
        #axis.title.x = element_text(color = color_ejes),
        #axis.title.y = element_text(color = color_ejes),
        #panel.grid.major = element_blank(), # Eliminando la cuadrícula principal
        #panel.grid.minor = element_blank() # Eliminando la cuadrícula secundaria
        )
```



# Analisis Recursos Hidricos para las Comunidades

## Mapa de Calor sobre el Volumend de Agua Suministrada para cada Comunidad


```{r,fig.width=7, fig.height=4, echo = FALSE}
# Calcula los valores máximos y mínimos para definir los límites de la paleta
max_valor <- max(ccaa_agua$`Volumen de agua registrada y distribuida`)
min_valor <- min(ccaa_agua$`Volumen de agua registrada y distribuida`)

# Define una paleta de colores basada en los valores de Total para 2021
paleta_colores <- scale_fill_gradientn(
  colors = rev(hcl.colors(11, "PuBu")),
  limits = c(min_valor, max_valor),# Elige la paleta de colores
  n.breaks = 11,  # O el número deseado de intervalos
  labels = scales::label_comma(),
  guide = guide_legend()
)

# Crea el mapa de calor
ggplot(filter(Agua_España, Comunidad != "Total Nacional" & Comunidad != "Ceuta y Melilla"), 
       aes(reorder(Siglas_Comunidad, `Volumen de agua registrada y distribuida`,decreasing=TRUE), Año, fill = `Volumen de agua registrada y distribuida`)) +
  geom_tile() +
  paleta_colores +
  labs(fill = "Volúmen (m3)",
       title = "Volúmen de Agua Suministrada para cada Comunidad Autónoma",
       x="Siglas Comunidad") +
  theme_minimal()
```




## Mapa de Calor sobre el Volumend de Agua por KM2 para cada Comunidad


```{r,fig.width=7, fig.height=4, echo = FALSE}
# Calcula los valores máximos y mínimos para definir los límites de la paleta
max_valor <-  max(filter(ccaa_agua,nuts2.name != "Ceuta y Melilla")$Agua_Km2)
min_valor <- min(ccaa_agua$Agua_Km2)

# Define una paleta de colores basada en los valores de Total para 2021
paleta_colores <- scale_fill_gradientn(
  colors = rev(hcl.colors(11, "PuBu")),
  limits = c(min_valor, max_valor),# Elige la paleta de colores
  n.breaks = 11,  # O el número deseado de intervalos
  labels = scales::label_comma(),
  guide = guide_legend()
)
# Crea el mapa de calor
ggplot(filter(Agua_España, Comunidad != "Total Nacional"& Comunidad != "Ceuta y Melilla"), 
       aes(reorder(Siglas_Comunidad, `Volumen de agua registrada y distribuida`,decreasing=TRUE), Año, fill = Agua_Km2)) +
  geom_tile() +
  paleta_colores +
  labs(fill = "Volúmen por Km2",
       title = "Volúmend de Agua por KM2 para cada Comunidad Autónoma",
       x="Siglas Comunidad") +
  theme_minimal()
```

\newpage

## Mapa de Calor sobre el Volumend de Agua Suministrada a los Hogares para cada Comunidad 

```{r,fig.width=7, fig.height=4, echo = FALSE}
# Calcula los valores máximos y mínimos para definir los límites de la paleta
max_valor <- max(ccaa_agua$Hogares)
min_valor <- min(ccaa_agua$Hogares)

# Define una paleta de colores basada en los valores de Total para 2021
paleta_colores <- scale_fill_gradientn(
  colors = rev(hcl.colors(11, "PuBu")),
  limits = c(min_valor, max_valor),# Elige la paleta de colores
  n.breaks = 11,  # O el número deseado de intervalos
  labels = scales::label_comma(),
  guide = guide_legend()
)

# Crea el mapa de calor
ggplot(filter(Agua_España, Comunidad != "Total Nacional"& Comunidad != "Ceuta y Melilla"), 
       aes(reorder(Siglas_Comunidad, `Volumen de agua registrada y distribuida`,decreasing=TRUE), Año, fill = Hogares)) +
  geom_tile() +
  paleta_colores +
  labs(fill = "Volúmen (m3)",
       title = "Volúmen de Agua Suministrada a los Hogares para cada Comunidad Autónoma",
       x="Siglas Comunidad") +
  theme_minimal()
```


## Mapa de Calor sobre el Consumo de Agua de cada Habitante para cada Comunidad 

```{r,fig.width=7, fig.height=4, echo = FALSE}
# Calcula los valores máximos y mínimos para definir los límites de la paleta
max_valor <- max(ccaa_agua$Consumo_Habitante)
min_valor <- min(ccaa_agua$Consumo_Habitante)

# Define una paleta de colores basada en los valores de Total para 2021
paleta_colores <- scale_fill_gradientn(
  colors = rev(hcl.colors(11, "PuBu")),
  limits = c(min_valor, max_valor),# Elige la paleta de colores
  n.breaks = 11,  # O el número deseado de intervalos
  labels = scales::label_comma(),
  guide = guide_legend()
)

# Crea el mapa de calor
ggplot(filter(Agua_España, Comunidad != "Total Nacional"& Comunidad != "Ceuta y Melilla"),
       aes(reorder(Siglas_Comunidad, `Volumen de agua registrada y distribuida`,decreasing=TRUE), Año, fill = Consumo_Habitante)) +
  geom_tile() +
  paleta_colores +
  labs(fill = "Consumo (L/dia)",
       title = "Consumo de Agua de cada Habitante para cada Comunidad Autónoma",
       x="Siglas Comunidad") +
  theme_minimal()
```

$$Consumo \space de \space Agua = \frac {Suministro \space Hogares * 1000 * 365 * 1000}{Poblacion} $$



## Mapa de Calor sobre el Agua Potable disponible en cada Comunidad 

```{r,fig.width=7, fig.height=4, echo = FALSE}
# Calcula los valores máximos y mínimos para definir los límites de la paleta
max_valor <- max(ccaa_agua$Disponible_para_Potabilizacion)
min_valor <- min(ccaa_agua$Disponible_para_Potabilizacion)

# Define una paleta de colores basada en los valores de Total para 2021
paleta_colores <- scale_fill_gradientn(
  colors = rev(hcl.colors(11, "PuBu")),
  limits = c(min_valor, max_valor),# Elige la paleta de colores
  n.breaks = 8,  # O el número deseado de intervalos
  labels = scales::label_comma(),
  guide = guide_legend()
)

# Crea el mapa de calor
ggplot(filter(Agua_España, Comunidad != "Total Nacional"& Comunidad != "Ceuta y Melilla"),
       aes(reorder(Siglas_Comunidad, `Volumen de agua registrada y distribuida`,decreasing=TRUE), Año,
           fill = Disponible_para_Potabilizacion)) +
  geom_tile() +
  paleta_colores +
  labs(fill = "Volúmen (m3)",
       title = "Agua Potable disponible en cada Comunidad Autónoma",
       x="Siglas Comunidad") +
  theme_minimal()
```

## Mapa de Calor sobre el Agua no Potable disponible en cada Comunidad 

```{r,fig.width=7, fig.height=4, echo = FALSE}
# Calcula los valores máximos y mínimos para definir los límites de la paleta
max_valor <- max(ccaa_agua$Disponible_no_Potabilizada)
min_valor <- min(ccaa_agua$Disponible_no_Potabilizada)

# Define una paleta de colores basada en los valores de Total para 2021
paleta_colores <- scale_fill_gradientn(
  colors = rev(hcl.colors(11, "PuBu")),
  limits = c(min_valor, max_valor),# Elige la paleta de colores
  n.breaks = 8,  # O el número deseado de intervalos
  labels = scales::label_comma(),
  guide = guide_legend()
)

# Crea el mapa de calor
ggplot(filter(Agua_España, Comunidad != "Total Nacional"& Comunidad != "Ceuta y Melilla"),
       aes(reorder(Siglas_Comunidad, `Volumen de agua registrada y distribuida`,decreasing=TRUE), Año,
           fill = Disponible_no_Potabilizada)) +
  geom_tile() +
  paleta_colores +
  labs(fill = "Volúmen (m3)",
       title = "Agua no Potable disponible en cada Comunidad Autónoma",
       x="Siglas Comunidad") +
  theme_minimal()
```


\newpage

# Mapa Recursos Hidricos en las Comunidades

## Mapa Suministro de Agua en las Comunidades de España

```{r,fig.width=7, fig.height=4, echo = FALSE}
# Calcula los valores máximos y mínimos para definir los límites de la paleta
max_valor <- max(ccaa_agua$`Volumen de agua registrada y distribuida`)
min_valor <- min(ccaa_agua$`Volumen de agua registrada y distribuida`)

# Define una paleta de colores basada en los valores de Total para 2021
paleta_colores <- scale_fill_gradientn(
  colors = rev(hcl.colors(11, "PuBu")),
  limits = c(min_valor, max_valor),# Elige la paleta de colores
  n.breaks = 11,  # O el número deseado de intervalos
  labels = scales::label_comma(),
  guide = guide_legend()
)

# Mapa 2021
ggplot(filter(ccaa_agua,Año == 2020)) +
  geom_sf(aes(fill = `Volumen de agua registrada y distribuida`), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Volúmen (m3)",
    title = "Volúmen de agua registrada y distribuida por Comunidad Autónoma",
    subtitle = "Datos 2020"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .3),
    plot.subtitle = element_text(hjust = .5))


# Mapa 2010
ggplot(filter(ccaa_agua,Año == 2010)) +
  geom_sf(aes(fill = `Volumen de agua registrada y distribuida`), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Volúmen (m3)",
    title = "Volúmen de agua registrada y distribuida por Comunidad Autónoma",
    subtitle = "Datos 2010"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .3),
    plot.subtitle = element_text(hjust = .5))


# Mapa 2000
ggplot(filter(ccaa_agua,Año == 2000)) +
  geom_sf(aes(fill = `Volumen de agua registrada y distribuida`), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Volúmen (m3)",
    title = "Volúmen de agua registrada y distribuida por Comunidad Autónoma",
    subtitle = "Datos 2000"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .3),
    plot.subtitle = element_text(hjust = .5))

```


## Mapa Suministro de Agua a los Hogares en las Comunidades de España

```{r,fig.width=7, fig.height=4, echo = FALSE}
# Calcula los valores máximos y mínimos para definir los límites de la paleta
max_valor <- max(ccaa_agua$Hogares)
min_valor <- min(ccaa_agua$Hogares)

# Define una paleta de colores basada en los valores de Total para 2021
paleta_colores <- scale_fill_gradientn(
  colors = rev(hcl.colors(11, "PuBu")),
  limits = c(min_valor, max_valor),# Elige la paleta de colores
  n.breaks = 11,  # O el número deseado de intervalos
  labels = scales::label_comma(),
  guide = guide_legend()
)

# Mapa 2021
ggplot(filter(ccaa_agua,Año == 2020)) +
  geom_sf(aes(fill = Hogares), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Volúmen (m3)",
    title = "Volúmen de agua Hogares por Comunidad Autónoma",
    subtitle = "Datos 2020"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .3),
    plot.subtitle = element_text(hjust = .5))


# Mapa 2010
ggplot(filter(ccaa_agua,Año == 2010)) +
  geom_sf(aes(fill = Hogares), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Volúmen (m3)",
    title = "Volúmen de agua Hogares por Comunidad Autónoma",
    subtitle = "Datos 2010"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .3),
    plot.subtitle = element_text(hjust = .5))


# Mapa 2000
ggplot(filter(ccaa_agua,Año == 2000)) +
  geom_sf(aes(fill = Hogares), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Volúmen (m3)",
    title = "Volúmen de agua Hogares por Comunidad Autónoma",
    subtitle = "Datos 2000"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .3),
    plot.subtitle = element_text(hjust = .5))

```


## Mapa Volumen de Agua por Km2 en las Comunidades de España

```{r,fig.width=7, fig.height=4, echo = FALSE}
# Calcula los valores máximos y mínimos para definir los límites de la paleta
max_valor <- max(filter(ccaa_agua,nuts2.name != "Ceuta y Melilla")$Agua_Km2)
min_valor <- min(ccaa_agua$Agua_Km2)

# Define una paleta de colores basada en los valores de Total para 2021
paleta_colores <- scale_fill_gradientn(
  colors = rev(hcl.colors(11, "PuBu")),
  limits = c(min_valor, max_valor),# Elige la paleta de colores
  n.breaks = 11,  # O el número deseado de intervalos
  labels = scales::label_comma(),
  guide = guide_legend()
)

# Mapa 2021
ggplot(filter(ccaa_agua,Año == 2020 & nuts2.name != "Ceuta y Melilla")) +
  geom_sf(aes(fill = Agua_Km2), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Volúmen por Km2",
    title = "Volúmen de agua por Km2 por Comunidad Autónoma",
    subtitle = "Datos 2020"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .3),
    plot.subtitle = element_text(hjust = .5))


# Mapa 2010
ggplot(filter(ccaa_agua,Año == 2010 & nuts2.name != "Ceuta y Melilla")) +
  geom_sf(aes(fill = Agua_Km2), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Volúmen por Km2",
    title = "Volúmen de agua por Km2 por Comunidad Autónoma",
    subtitle = "Datos 2010"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .3),
    plot.subtitle = element_text(hjust = .5))


# Mapa 2000
ggplot(filter(ccaa_agua,Año == 2000 & nuts2.name != "Ceuta y Melilla")) +
  geom_sf(aes(fill = Agua_Km2), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Volúmen por Km2",
    title = "Volúmen de agua por Km2 por Comunidad Autónoma",
    subtitle = "Datos 2000"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .3),
    plot.subtitle = element_text(hjust = .5))

```



## Mapa Consumo habitante en las Comunidades de España

```{r,fig.width=7, fig.height=4, echo = FALSE}
# Calcula los valores máximos y mínimos para definir los límites de la paleta
max_valor <- max(ccaa_agua$Consumo_Habitante)
min_valor <- min(ccaa_agua$Consumo_Habitante)

# Define una paleta de colores basada en los valores de Total para 2021
paleta_colores <- scale_fill_gradientn(
  colors = rev(hcl.colors(11, "PuBu")),
  limits = c(min_valor, max_valor),# Elige la paleta de colores
  n.breaks = 11,  # O el número deseado de intervalos
  labels = scales::label_comma(),
  guide = guide_legend()
)

# Mapa 2021
ggplot(filter(ccaa_agua,Año == 2020 & nuts2.name != "Ceuta y Melilla")) +
  geom_sf(aes(fill = Consumo_Habitante), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Consumo (L/dia)",
    title = "Consumo Habitante por Comunidad Autónoma",
    subtitle = "Datos 2020"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .3),
    plot.subtitle = element_text(hjust = .5))


# Mapa 2010
ggplot(filter(ccaa_agua,Año == 2010 & nuts2.name != "Ceuta y Melilla")) +
  geom_sf(aes(fill = Consumo_Habitante), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Consumo (L/dia)",
    title = "Consumo Habitante por Comunidad Autónoma",
    subtitle = "Datos 2010"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .3),
    plot.subtitle = element_text(hjust = .5))


# Mapa 2000
ggplot(filter(ccaa_agua,Año == 2000 & nuts2.name != "Ceuta y Melilla")) +
  geom_sf(aes(fill = Consumo_Habitante), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Consumo (L/dia)",
    title = "Consumo Habitante por Comunidad Autónoma",
    subtitle = "Datos 2000"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .3),
    plot.subtitle = element_text(hjust = .5))

```


## Mapa Variacion de Suministro de Agua a los Hogares en las Comunidades de España

```{r,fig.width=7, fig.height=4, echo = FALSE}
# Calcula los valores máximos y mínimos para definir los límites de la paleta
max_valor <- max(filter(ccaa_agua,Año == 2020)$Variacion_Hogares_10)
min_valor <- min(filter(ccaa_agua,Año == 2020)$Variacion_Hogares_10)

# Define una paleta de colores basada en los valores de Total para 2021
paleta_colores <- scale_fill_gradientn(
  colors = hcl.colors(11, "RdBu"),
  limits = c(min_valor, max_valor),# Elige la paleta de colores
  n.breaks = 8,  # O el número deseado de intervalos
  labels = scales::label_comma(),
  guide = guide_legend()
)

# Mapa 2021
ggplot(filter(ccaa_agua,Año == 2020)) +
  geom_sf(aes(fill = Variacion_Hogares_2), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Variación 2 años",
    title = "Variación del Volumen de agua Hogares por Comunidad Autónoma",
    subtitle = "Variación ente 2020-2018"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .3),
    plot.subtitle = element_text(hjust = .5))


# Mapa 2010
ggplot(filter(ccaa_agua,Año == 2020)) +
  geom_sf(aes(fill = Variacion_Hogares_4), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Variación 4 años",
    title = "Variación del Volumen de agua Hogares por Comunidad Autónoma",
    subtitle = "Variación ente 2020-2016"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .3),
    plot.subtitle = element_text(hjust = .5))


# Mapa 2000
ggplot(filter(ccaa_agua,Año == 2020)) +
  geom_sf(aes(fill = Variacion_Hogares_10), alpha = 0.9,color = "black") +
  paleta_colores +
  labs(
    fill = "Variación 10 años",
    title = "Variación del Volumen de agua Hogares por Comunidad Autónoma",
    subtitle = "Variación ente 2020-2010"
  ) +
  theme_void() +
  theme(
    text = element_text(face = "bold"),
    plot.title = element_text(hjust = .3),
    plot.subtitle = element_text(hjust = .5))

```



\newpage




